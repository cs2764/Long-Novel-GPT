# å¯åŠ¨å™¨ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

Long-Novel-GPT 3.0 Enhanced Edition æä¾›äº†å®Œæ•´çš„å¯åŠ¨å™¨ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§å¯åŠ¨æ–¹å¼å’Œè·¨å¹³å°å…¼å®¹æ€§ã€‚æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¯åŠ¨å™¨çš„æ¶æ„è®¾è®¡ã€å®ç°åŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚

## ç³»ç»Ÿæ¶æ„

### å¯åŠ¨å™¨ç”Ÿæ€ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Long-Novel-GPT å¯åŠ¨å™¨ç³»ç»Ÿ                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Pythonå¯åŠ¨å™¨   â”‚  â”‚  Windowsæ‰¹å¤„ç†   â”‚  â”‚  Shellè„šæœ¬  â”‚ â”‚
â”‚  â”‚  (launcher.py)   â”‚  â”‚ (start_local.bat)â”‚  â”‚(.sh/.ps1)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                       â”‚                  â”‚       â”‚
â”‚           â–¼                       â–¼                  â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚              æ ¸å¿ƒå¯åŠ¨é€»è¾‘                                 â”‚ â”‚
â”‚  â”‚  â€¢ ç¯å¢ƒæ£€æŸ¥  â€¢ ä¾èµ–å®‰è£…  â€¢ ç«¯å£ç®¡ç†  â€¢ è¿›ç¨‹æ§åˆ¶         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚           â”‚                       â”‚                  â”‚       â”‚
â”‚           â–¼                       â–¼                  â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    åç«¯æœåŠ¡      â”‚  â”‚    å‰ç«¯æœåŠ¡      â”‚  â”‚  æµè§ˆå™¨æ‰“å¼€  â”‚ â”‚
â”‚  â”‚  (backend/app.py)â”‚  â”‚(frontend_server) â”‚  â”‚  (è‡ªåŠ¨æ‰“å¼€)  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒå¯åŠ¨å™¨è®¾è®¡

### 1. Pythonå¯åŠ¨å™¨ (launcher.py)

**ä½ç½®ï¼š** `launcher.py`

**è®¾è®¡ç‰¹ç‚¹ï¼š**
- è·¨å¹³å°å…¼å®¹æ€§ (Windows, macOS, Linux)
- è‡ªåŠ¨ä¾èµ–æ£€æŸ¥å’Œå®‰è£…
- æ™ºèƒ½ç«¯å£ç®¡ç†
- ä¼˜é›…çš„è¿›ç¨‹æ§åˆ¶
- è‡ªåŠ¨æµè§ˆå™¨æ‰“å¼€

**ç±»ç»“æ„ï¼š**
```python
class LongNovelLauncher:
    """Long-Novel-GPT å¯åŠ¨å™¨"""
    
    def __init__(self):
        self.project_root = Path(__file__).parent
        self.backend_process = None
        self.frontend_process = None
        self.backend_port = int(os.environ.get('BACKEND_PORT', 7869))
        self.frontend_port = int(os.environ.get('FRONTEND_PORT', 8099))
        self.backend_host = os.environ.get('BACKEND_HOST', '127.0.0.1')
        
        # è®¾ç½®ä¿¡å·å¤„ç†
        signal.signal(signal.SIGINT, self.signal_handler)
        signal.signal(signal.SIGTERM, self.signal_handler)
```

### 2. æ™ºèƒ½ç«¯å£ç®¡ç†

**ç«¯å£æ£€æµ‹é€»è¾‘ï¼š**
```python
def find_free_port(self, start_port):
    """å¯»æ‰¾å¯ç”¨çš„ç«¯å£"""
    for port in range(start_port, start_port + 100):
        try:
            with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
                s.bind(('', port))
                return port
        except OSError:
            continue
    return start_port

def check_port_available(self, port):
    """æ£€æŸ¥ç«¯å£æ˜¯å¦å¯ç”¨"""
    try:
        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
            s.bind(('', port))
            return True
    except OSError:
        return False
```

**ç«¯å£ç®¡ç†æµç¨‹ï¼š**
1. æ£€æŸ¥é»˜è®¤ç«¯å£æ˜¯å¦å¯ç”¨
2. å¦‚æœè¢«å ç”¨ï¼Œè‡ªåŠ¨å¯»æ‰¾å¯ç”¨ç«¯å£
3. æ›´æ–°ç¯å¢ƒå˜é‡
4. æ˜¾ç¤ºå®é™…ä½¿ç”¨çš„ç«¯å£

### 3. ä¾èµ–æ£€æŸ¥ç³»ç»Ÿ

```python
def check_dependencies(self):
    """æ£€æŸ¥ä¾èµ–"""
    print("ğŸ” æ£€æŸ¥ç³»ç»Ÿä¾èµ–...")
    
    # æ£€æŸ¥Pythonç‰ˆæœ¬
    if sys.version_info < (3, 8):
        print("âŒ éœ€è¦Python 3.8æˆ–æ›´é«˜ç‰ˆæœ¬")
        return False
    
    print(f"âœ… Pythonç‰ˆæœ¬: {sys.version.split()[0]}")
    
    # æ£€æŸ¥å¿…è¦æ¨¡å—
    required_modules = ['flask', 'flask_cors', 'requests']
    missing_modules = []
    
    for module in required_modules:
        try:
            __import__(module)
        except ImportError:
            missing_modules.append(module)
    
    if missing_modules:
        print(f"âŒ ç¼ºå°‘ä¾èµ–æ¨¡å—: {', '.join(missing_modules)}")
        print("è¯·è¿è¡Œ: pip install -r requirements.txt")
        return False
    
    print("âœ… æ‰€æœ‰ä¾èµ–æ¨¡å—å·²å®‰è£…")
    return True
```

### 4. è¿›ç¨‹ç®¡ç†

**å¯åŠ¨åç«¯æœåŠ¡ï¼š**
```python
def start_backend(self):
    """å¯åŠ¨åç«¯æœåŠ¡"""
    backend_script = self.project_root / 'backend' / 'app.py'
    
    if not backend_script.exists():
        print("âŒ åç«¯è„šæœ¬ä¸å­˜åœ¨")
        return False
    
    # æ£€æŸ¥åç«¯ç«¯å£
    if not self.check_port_available(self.backend_port):
        print(f"âš ï¸  åç«¯ç«¯å£ {self.backend_port} å·²è¢«å ç”¨ï¼Œè‡ªåŠ¨å¯»æ‰¾å¯ç”¨ç«¯å£...")
        self.backend_port = self.find_free_port(self.backend_port)
    
    print(f"ğŸš€ å¯åŠ¨åç«¯æœåŠ¡ (ç«¯å£: {self.backend_port})")
    
    # è®¾ç½®ç¯å¢ƒå˜é‡
    env = os.environ.copy()
    env['BACKEND_PORT'] = str(self.backend_port)
    env['BACKEND_HOST'] = self.backend_host
    
    try:
        self.backend_process = subprocess.Popen(
            [sys.executable, str(backend_script)],
            env=env,
            cwd=str(self.project_root / 'backend'),
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE
        )
        
        # ç­‰å¾…åç«¯å¯åŠ¨
        print("â³ ç­‰å¾…åç«¯æœåŠ¡å¯åŠ¨...")
        time.sleep(3)
        
        # æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨æˆåŠŸ
        if self.backend_process.poll() is None:
            print(f"âœ… åç«¯æœåŠ¡å·²å¯åŠ¨åœ¨ç«¯å£ {self.backend_port}")
            return True
        else:
            stdout, stderr = self.backend_process.communicate()
            print(f"âŒ åç«¯å¯åŠ¨å¤±è´¥")
            if stderr:
                print(f"é”™è¯¯ä¿¡æ¯: {stderr.decode()}")
            return False
            
    except Exception as e:
        print(f"âŒ å¯åŠ¨åç«¯å¤±è´¥: {e}")
        return False
```

**å¯åŠ¨å‰ç«¯æœåŠ¡ï¼š**
```python
def start_frontend(self):
    """å¯åŠ¨å‰ç«¯æœåŠ¡"""
    frontend_script = self.project_root / 'frontend_server.py'
    
    if not frontend_script.exists():
        print("âŒ å‰ç«¯æœåŠ¡å™¨è„šæœ¬ä¸å­˜åœ¨")
        return False
    
    # æ£€æŸ¥å‰ç«¯ç«¯å£
    if not self.check_port_available(self.frontend_port):
        print(f"âš ï¸  å‰ç«¯ç«¯å£ {self.frontend_port} å·²è¢«å ç”¨ï¼Œè‡ªåŠ¨å¯»æ‰¾å¯ç”¨ç«¯å£...")
        self.frontend_port = self.find_free_port(self.frontend_port)
    
    print(f"ğŸŒ å¯åŠ¨å‰ç«¯æœåŠ¡ (ç«¯å£: {self.frontend_port})")
    print(f"ğŸŒ å±€åŸŸç½‘è®¿é—®: http://{self.get_local_ip()}:{self.frontend_port}")
    
    # è®¾ç½®ç¯å¢ƒå˜é‡
    env = os.environ.copy()
    env['FRONTEND_PORT'] = str(self.frontend_port)
    env['BACKEND_PORT'] = str(self.backend_port)
    env['BACKEND_HOST'] = self.backend_host
    
    # è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    frontend_url = f"http://localhost:{self.frontend_port}"
    print(f"ğŸ”„ å‡†å¤‡æ‰“å¼€æµè§ˆå™¨...")
    self.open_browser(frontend_url)
    
    try:
        self.frontend_process = subprocess.Popen(
            [sys.executable, str(frontend_script)],
            env=env,
            cwd=str(self.project_root)
        )
        return True
        
    except Exception as e:
        print(f"âŒ å¯åŠ¨å‰ç«¯å¤±è´¥: {e}")
        return False
```

### 5. ä¼˜é›…å…³é—­æœºåˆ¶

```python
def signal_handler(self, signum, frame):
    """ä¿¡å·å¤„ç†å™¨"""
    print(f"\nğŸ›‘ æ”¶åˆ°åœæ­¢ä¿¡å· ({signum})ï¼Œæ­£åœ¨å…³é—­æœåŠ¡...")
    self.cleanup()
    sys.exit(0)

def cleanup(self):
    """æ¸…ç†è¿›ç¨‹"""
    print("ğŸ§¹ æ¸…ç†è¿›ç¨‹...")
    
    if self.frontend_process:
        try:
            self.frontend_process.terminate()
            self.frontend_process.wait(timeout=5)
            print("âœ… å‰ç«¯æœåŠ¡å·²åœæ­¢")
        except:
            self.frontend_process.kill()
            print("âš ï¸  å¼ºåˆ¶åœæ­¢å‰ç«¯æœåŠ¡")
    
    if self.backend_process:
        try:
            self.backend_process.terminate()
            self.backend_process.wait(timeout=5)
            print("âœ… åç«¯æœåŠ¡å·²åœæ­¢")
        except:
            self.backend_process.kill()
            print("âš ï¸  å¼ºåˆ¶åœæ­¢åç«¯æœåŠ¡")
```

## å‰ç«¯æœåŠ¡å™¨è®¾è®¡

### 1. å‰ç«¯æœåŠ¡å™¨ (frontend_server.py)

**ä½ç½®ï¼š** `frontend_server.py`

**åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- é™æ€æ–‡ä»¶æœåŠ¡
- APIä»£ç†åˆ°åç«¯
- è‡ªåŠ¨ç«¯å£æ£€æµ‹
- åç«¯å¥åº·æ£€æŸ¥
- è‡ªåŠ¨æµè§ˆå™¨æ‰“å¼€

**æ ¸å¿ƒå®ç°ï¼š**
```python
class APIProxyHandler(http.server.SimpleHTTPRequestHandler):
    """APIä»£ç†å¤„ç†å™¨"""
    
    def do_GET(self):
        if self.path.startswith('/api/'):
            self.proxy_to_backend()
        else:
            super().do_GET()
    
    def do_POST(self):
        if self.path.startswith('/api/'):
            self.proxy_to_backend()
        else:
            self.send_error(404, "Not Found")
    
    def proxy_to_backend(self):
        """ä»£ç†è¯·æ±‚åˆ°åç«¯æœåŠ¡"""
        # æ„å»ºåç«¯URLï¼ˆç§»é™¤/apiå‰ç¼€ï¼‰
        backend_path = self.path[4:] if self.path.startswith('/api/') else self.path
        backend_url = f"http://{BACKEND_HOST}:{BACKEND_PORT}{backend_path}"
        
        try:
            # è¯»å–è¯·æ±‚ä½“
            content_length = int(self.headers.get('Content-Length', 0))
            post_data = self.rfile.read(content_length) if content_length > 0 else None
            
            # åˆ›å»ºè¯·æ±‚
            req = urllib.request.Request(backend_url, data=post_data, method=self.command)
            
            # å¤åˆ¶è¯·æ±‚å¤´
            skip_headers = {'host', 'content-length', 'connection'}
            for key, value in self.headers.items():
                if key.lower() not in skip_headers:
                    req.add_header(key, value)
            
            # å‘é€è¯·æ±‚
            with urllib.request.urlopen(req, timeout=60) as response:
                # è®¾ç½®å“åº”çŠ¶æ€ç 
                self.send_response(response.getcode())
                
                # å¤åˆ¶å“åº”å¤´
                skip_response_headers = {'server', 'date', 'transfer-encoding'}
                for key, value in response.headers.items():
                    if key.lower() not in skip_response_headers:
                        self.send_header(key, value)
                
                # æ·»åŠ CORSå¤´
                self.send_header('Access-Control-Allow-Origin', '*')
                self.send_header('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')
                self.send_header('Access-Control-Allow-Headers', 'Content-Type, Authorization')
                
                self.end_headers()
                
                # å‘é€å“åº”ä½“
                self.wfile.write(response.read())
                
        except Exception as e:
            print(f"ä»£ç†è¯·æ±‚å¤±è´¥: {e}")
            self.send_error(502, f"Bad Gateway: {e}")
```

### 2. åç«¯å¥åº·æ£€æŸ¥

```python
def check_backend_status():
    """æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€"""
    try:
        response = urllib.request.urlopen(f"http://{BACKEND_HOST}:{BACKEND_PORT}/health", timeout=5)
        return response.getcode() == 200
    except:
        return False
```

## Windowså¯åŠ¨è„šæœ¬

### 1. æ‰¹å¤„ç†è„šæœ¬ (start_local.bat)

**ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨åˆ›å»ºcondaç¯å¢ƒ
- æ™ºèƒ½ä¾èµ–æ£€æŸ¥
- å¹¶è¡Œå¯åŠ¨æœåŠ¡
- è‡ªåŠ¨æµè§ˆå™¨æ‰“å¼€

**æ ¸å¿ƒé€»è¾‘ï¼š**
```batch
@echo off
chcp 65001 > nul
setlocal enabledelayedexpansion

REM é…ç½®
set DEFAULT_ENV_NAME=long-novel-gpt
set DEFAULT_PYTHON_VERSION=3.10
set BACKEND_PORT=7869
set FRONTEND_PORT=8080

REM æ£€æŸ¥condaç¯å¢ƒ
conda info --envs | findstr /C:"%DEFAULT_ENV_NAME%" >nul 2>&1
if errorlevel 1 (
    echo [åˆ›å»º] è™šæ‹Ÿç¯å¢ƒ %DEFAULT_ENV_NAME% ä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆ›å»º...
    conda create -n %DEFAULT_ENV_NAME% python=%DEFAULT_PYTHON_VERSION% -y
)

REM æ¿€æ´»ç¯å¢ƒå¹¶å¯åŠ¨æœåŠ¡
call conda activate %DEFAULT_ENV_NAME%
start "åç«¯æœåŠ¡" cmd /k "cd backend && python app.py"
timeout /t 3 /nobreak >nul
start "å‰ç«¯æœåŠ¡" cmd /k "python frontend_server.py"
```

### 2. PowerShellè„šæœ¬ (start_local.ps1)

**ç‰¹ç‚¹ï¼š**
- å½©è‰²è¾“å‡º
- è¯¦ç»†çŠ¶æ€æ˜¾ç¤º
- é”™è¯¯å¤„ç†
- åå°ä½œä¸šç®¡ç†

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
```powershell
# å¯åŠ¨åç«¯æœåŠ¡
Write-ColorText "ğŸš€ å¯åŠ¨åç«¯æœåŠ¡ (ç«¯å£: $BackendPort)" "Blue"
$backendJob = Start-Job -ScriptBlock {
    Set-Location $using:PWD
    conda activate $using:EnvName
    Set-Location backend
    python app.py
} -Name "BackendService"

# å¯åŠ¨å‰ç«¯æœåŠ¡
Write-ColorText "ğŸŒ å¯åŠ¨å‰ç«¯æœåŠ¡ (ç«¯å£: $FrontendPort)" "Blue"
$frontendJob = Start-Job -ScriptBlock {
    Set-Location $using:PWD
    conda activate $using:EnvName
    python frontend_server.py
} -Name "FrontendService"

# æ‰“å¼€æµè§ˆå™¨
Write-ColorText "ğŸŒ æ­£åœ¨æ‰“å¼€æµè§ˆå™¨..." "Blue"
Start-Process "http://localhost:$FrontendPort"
```

## è‡ªåŠ¨æµè§ˆå™¨æ‰“å¼€

### 1. å»¶è¿Ÿæ‰“å¼€æœºåˆ¶

```python
def open_browser(self, url, delay=3):
    """å»¶è¿Ÿæ‰“å¼€æµè§ˆå™¨"""
    def delayed_open():
        time.sleep(delay)
        try:
            webbrowser.open(url)
            print(f"âœ… æµè§ˆå™¨å·²è‡ªåŠ¨æ‰“å¼€: {url}")
        except Exception as e:
            print(f"âŒ æ‰“å¼€æµè§ˆå™¨å¤±è´¥: {e}")
            print(f"è¯·æ‰‹åŠ¨è®¿é—®: {url}")
    
    thread = threading.Thread(target=delayed_open)
    thread.daemon = True
    thread.start()
```

### 2. è·¨å¹³å°å…¼å®¹æ€§

```python
def get_local_ip(self):
    """è·å–æœ¬æœºIPåœ°å€"""
    try:
        with socket.socket(socket.AF_INET, socket.SOCK_DGRAM) as s:
            s.connect(("8.8.8.8", 80))
            return s.getsockname()[0]
    except:
        return "localhost"
```

## å¯åŠ¨æ–¹å¼å¯¹æ¯”

| å¯åŠ¨æ–¹å¼ | å¹³å°æ”¯æŒ | ä¾èµ–ç®¡ç† | è‡ªåŠ¨åŒ–ç¨‹åº¦ | é€‚ç”¨åœºæ™¯ |
|----------|----------|----------|------------|----------|
| **launcher.py** | å…¨å¹³å° | è‡ªåŠ¨æ£€æŸ¥ | é«˜ | ç”Ÿäº§ç¯å¢ƒ |
| **frontend_server.py** | å…¨å¹³å° | éœ€æ‰‹åŠ¨ | ä¸­ | å‰ç«¯å¼€å‘ |
| **start_local.bat** | Windows | è‡ªåŠ¨åˆ›å»º | é«˜ | Windowsç”¨æˆ· |
| **start_local.ps1** | Windows | è‡ªåŠ¨åˆ›å»º | é«˜ | é«˜çº§ç”¨æˆ· |
| **start_local.sh** | Unix/Linux | è‡ªåŠ¨æ£€æŸ¥ | é«˜ | Linux/macOS |

## é…ç½®ç®¡ç†

### 1. ç¯å¢ƒå˜é‡é…ç½®

```bash
# ç«¯å£é…ç½®
export FRONTEND_PORT=8099
export BACKEND_PORT=7869
export BACKEND_HOST=127.0.0.1

# å¼€å‘æ¨¡å¼
export DEBUG=1
export FLASK_ENV=development
```

### 2. é…ç½®æ–‡ä»¶

**Windowsé…ç½®æ–‡ä»¶ï¼š**
```ini
[DEFAULT]
FRONTEND_PORT=8099
BACKEND_PORT=7869
BACKEND_HOST=127.0.0.1
ENV_NAME=long-novel-gpt
PYTHON_VERSION=3.10
```

**Unixé…ç½®æ–‡ä»¶ï¼š**
```bash
#!/bin/bash
export FRONTEND_PORT=8099
export BACKEND_PORT=7869
export BACKEND_HOST=127.0.0.1
```

## ç›‘æ§å’Œæ—¥å¿—

### 1. æœåŠ¡çŠ¶æ€ç›‘æ§

```python
def monitor_services(self):
    """ç›‘æ§æœåŠ¡çŠ¶æ€"""
    while True:
        try:
            # æ£€æŸ¥åç«¯çŠ¶æ€
            backend_status = self.check_backend_status()
            
            # æ£€æŸ¥å‰ç«¯çŠ¶æ€
            frontend_status = self.frontend_process and self.frontend_process.poll() is None
            
            if not backend_status:
                print("âš ï¸  åç«¯æœåŠ¡å¼‚å¸¸ï¼Œå°è¯•é‡å¯...")
                self.restart_backend()
            
            if not frontend_status:
                print("âš ï¸  å‰ç«¯æœåŠ¡å¼‚å¸¸ï¼Œå°è¯•é‡å¯...")
                self.restart_frontend()
            
            time.sleep(30)  # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
            
        except KeyboardInterrupt:
            break
        except Exception as e:
            print(f"ç›‘æ§å¼‚å¸¸: {e}")
            time.sleep(10)
```

### 2. æ—¥å¿—ç³»ç»Ÿ

```python
import logging
from datetime import datetime

def setup_logging():
    """è®¾ç½®æ—¥å¿—ç³»ç»Ÿ"""
    log_format = '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    
    # æ§åˆ¶å°æ—¥å¿—
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.INFO)
    console_formatter = logging.Formatter(log_format)
    console_handler.setFormatter(console_formatter)
    
    # æ–‡ä»¶æ—¥å¿—
    file_handler = logging.FileHandler('launcher.log')
    file_handler.setLevel(logging.DEBUG)
    file_formatter = logging.Formatter(log_format)
    file_handler.setFormatter(file_formatter)
    
    # æ ¹æ—¥å¿—å™¨
    logger = logging.getLogger('launcher')
    logger.setLevel(logging.DEBUG)
    logger.addHandler(console_handler)
    logger.addHandler(file_handler)
    
    return logger
```

## æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜

**é—®é¢˜1ï¼šç«¯å£è¢«å ç”¨**
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :8099  # Windows
lsof -i :8099                 # macOS/Linux

# è‡ªåŠ¨è§£å†³
# å¯åŠ¨å™¨ä¼šè‡ªåŠ¨å¯»æ‰¾å¯ç”¨ç«¯å£
```

**é—®é¢˜2ï¼šä¾èµ–ç¼ºå¤±**
```bash
# æ£€æŸ¥ä¾èµ–
pip list | grep flask

# è‡ªåŠ¨å®‰è£…
pip install -r requirements.txt
```

**é—®é¢˜3ï¼šæƒé™é—®é¢˜**
```bash
# Windows
# ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell

# macOS/Linux
chmod +x start_local.sh
```

### 2. è°ƒè¯•æ¨¡å¼

```python
# å¯ç”¨è°ƒè¯•æ¨¡å¼
export DEBUG=1
python launcher.py

# è¯¦ç»†æ—¥å¿—
export LAUNCHER_DEBUG=1
python launcher.py
```

### 3. æ‰‹åŠ¨å¯åŠ¨éªŒè¯

```bash
# æ‰‹åŠ¨å¯åŠ¨åç«¯
cd backend
python app.py

# æ‰‹åŠ¨å¯åŠ¨å‰ç«¯
python frontend_server.py

# éªŒè¯æœåŠ¡
curl http://localhost:7869/health
curl http://localhost:8099/
```

## æ€§èƒ½ä¼˜åŒ–

### 1. å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–

- **å¹¶è¡Œå¯åŠ¨**ï¼šåŒæ—¶å¯åŠ¨å‰åç«¯æœåŠ¡
- **æ‡’åŠ è½½**ï¼šä»…åœ¨éœ€è¦æ—¶åŠ è½½æ¨¡å—
- **ç¼“å­˜æ£€æŸ¥**ï¼šé¿å…é‡å¤çš„ä¾èµ–æ£€æŸ¥

### 2. èµ„æºç®¡ç†

- **è¿›ç¨‹ç›‘æ§**ï¼šç›‘æ§å­è¿›ç¨‹çŠ¶æ€
- **å†…å­˜ç®¡ç†**ï¼šåŠæ—¶æ¸…ç†æ— ç”¨å¯¹è±¡
- **è¿æ¥æ± **ï¼šå¤ç”¨ç½‘ç»œè¿æ¥

### 3. é”™è¯¯æ¢å¤

```python
def auto_restart_service(self, service_name, max_retries=3):
    """è‡ªåŠ¨é‡å¯æœåŠ¡"""
    for attempt in range(max_retries):
        try:
            if service_name == "backend":
                success = self.start_backend()
            elif service_name == "frontend":
                success = self.start_frontend()
            
            if success:
                print(f"âœ… {service_name} é‡å¯æˆåŠŸ")
                return True
            else:
                print(f"âŒ {service_name} é‡å¯å¤±è´¥ï¼Œå°è¯• {attempt + 1}/{max_retries}")
                time.sleep(5)
                
        except Exception as e:
            print(f"âŒ {service_name} é‡å¯å¼‚å¸¸: {e}")
            time.sleep(5)
    
    print(f"âŒ {service_name} é‡å¯å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")
    return False
```

## æ‰©å±•æŒ‡å—

### 1. æ·»åŠ æ–°çš„å¯åŠ¨æ–¹å¼

```python
class DockerLauncher(LongNovelLauncher):
    """Dockerå¯åŠ¨å™¨"""
    
    def start_backend(self):
        """ä½¿ç”¨Dockerå¯åŠ¨åç«¯"""
        try:
            subprocess.run([
                'docker', 'run', '-d',
                '--name', 'lngpt-backend',
                '-p', f'{self.backend_port}:7869',
                'lngpt-backend:latest'
            ], check=True)
            return True
        except subprocess.CalledProcessError:
            return False
    
    def start_frontend(self):
        """ä½¿ç”¨Dockerå¯åŠ¨å‰ç«¯"""
        try:
            subprocess.run([
                'docker', 'run', '-d',
                '--name', 'lngpt-frontend',
                '-p', f'{self.frontend_port}:8099',
                'lngpt-frontend:latest'
            ], check=True)
            return True
        except subprocess.CalledProcessError:
            return False
```

### 2. è‡ªå®šä¹‰é…ç½®é€‰é¡¹

```python
class CustomLauncher(LongNovelLauncher):
    """è‡ªå®šä¹‰å¯åŠ¨å™¨"""
    
    def __init__(self, config_file=None):
        super().__init__()
        self.config_file = config_file or "launcher_config.json"
        self.load_custom_config()
    
    def load_custom_config(self):
        """åŠ è½½è‡ªå®šä¹‰é…ç½®"""
        try:
            with open(self.config_file, 'r') as f:
                config = json.load(f)
            
            self.backend_port = config.get('backend_port', self.backend_port)
            self.frontend_port = config.get('frontend_port', self.frontend_port)
            self.auto_open_browser = config.get('auto_open_browser', True)
            
        except FileNotFoundError:
            self.create_default_config()
    
    def create_default_config(self):
        """åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶"""
        default_config = {
            'backend_port': 7869,
            'frontend_port': 8099,
            'auto_open_browser': True,
            'backend_host': '127.0.0.1'
        }
        
        with open(self.config_file, 'w') as f:
            json.dump(default_config, f, indent=2)
```

## æœ€ä½³å®è·µ

### 1. å¼€å‘ç¯å¢ƒ

- ä½¿ç”¨ `launcher.py` è¿›è¡Œä¸€é”®å¯åŠ¨
- é…ç½®IDEé›†æˆï¼Œç›´æ¥ä»IDEå¯åŠ¨
- ä½¿ç”¨è°ƒè¯•æ¨¡å¼è·å–è¯¦ç»†æ—¥å¿—

### 2. ç”Ÿäº§ç¯å¢ƒ

- ä½¿ç”¨ç³»ç»ŸæœåŠ¡ç®¡ç†å™¨ (systemd, Windows Service)
- é…ç½®è‡ªåŠ¨é‡å¯æœºåˆ¶
- ç›‘æ§æœåŠ¡çŠ¶æ€å’Œæ€§èƒ½

### 3. æµ‹è¯•ç¯å¢ƒ

- ä½¿ç”¨Dockerå®¹å™¨è¿›è¡Œéš”ç¦»
- é…ç½®CI/CDè‡ªåŠ¨åŒ–éƒ¨ç½²
- è¿›è¡Œè´Ÿè½½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•

## æ€»ç»“

å¯åŠ¨å™¨ç³»ç»Ÿä¸ºLong-Novel-GPTæä¾›äº†å®Œæ•´çš„å¯åŠ¨è§£å†³æ–¹æ¡ˆï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **è·¨å¹³å°å…¼å®¹**ï¼šæ”¯æŒWindowsã€macOSã€Linux
- **æ™ºèƒ½åŒ–ç®¡ç†**ï¼šè‡ªåŠ¨ç«¯å£æ£€æµ‹ã€ä¾èµ–æ£€æŸ¥ã€é”™è¯¯æ¢å¤
- **å¤šç§å¯åŠ¨æ–¹å¼**ï¼šPythonè„šæœ¬ã€æ‰¹å¤„ç†ã€Shellè„šæœ¬
- **ä¼˜é›…çš„è¿›ç¨‹æ§åˆ¶**ï¼šä¿¡å·å¤„ç†ã€èµ„æºæ¸…ç†
- **ç”¨æˆ·å‹å¥½**ï¼šè‡ªåŠ¨æµè§ˆå™¨æ‰“å¼€ã€è¯¦ç»†çŠ¶æ€æ˜¾ç¤º
- **å¯æ‰©å±•æ€§**ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œè‡ªå®šä¹‰é…ç½®

è¿™ä¸ªç³»ç»Ÿå¤§å¤§ç®€åŒ–äº†åº”ç”¨çš„éƒ¨ç½²å’Œè¿è¡Œï¼Œæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ 